# IDSにおける許容値

## 平等の寛容

丸め誤差のため、浮動小数点数(ids:simpleValueとxs:restrictionではdouble)の等値性については常に許容値を考慮しなければならない。

平方メートルで表される電線の面積のような低い数値と、鉄道の長さのような高い数値の両方をサポートするために、IDSは公式に従って相対成分と固定成分の両方を使用する：

`x == v ⇒ (v - abs(v) × ϵ - ϵ) < x < (v + abs(v) × ϵ + ϵ)`
with a tolerance value being: `ϵ = 1.0e⁻⁶`

以下の表は、公差内の値の特徴的な範囲を示している：

| v | 下界<br>`(v - abs(v) × ε - ε) | 上界<br>`(v + abs(v) × ε + ε) | 絶対デルタ |
| ---------: | ------------------------------------: | ------------------------------------: | -------------: |
| 100000.0 | 99999.899999 | 100000.100001 | 0.200002 |
| 10000.0 | 9999.989999 | 10000.010001 | 0.020002 |
| 1000.0 | 999.998999 | 1000.001001 | 0.002002 |
| 100.0 | 99.999899 | 100.000101 | 0.000202 |
| 10.0 | 9.999989 | 10.000011 | 2.2E-05 |
| 1.0 | 0.999998 | 1.000002 | 4E-06 |
| 0.1 | 0.0999989 | 0.1000011 | 2.2E-06 |
| 0.01 | 0.00999899 | 0.01000101 | 2.02E-06 |
| 0.001 | 0.000998999 | 0.001001001 | 2.002E-06 |
| 0.0001 | 0.0000989999 | 0.0001010001 | 2.0002E-06 |
| 0.00001 | 0.00000899999 | 0.00001100001 | 2.00002E-06 |
| 0.000001 | -0.000000000001 | 0.000002000001 | 2.000002E-06 |
| 0.0000001 | -0.0000009000001 | 0.0000011000001 | 2.0000002E-06 |
| 0 | -0.000001 | 0.000001 | 2.0E-06 |
| -0.0000001 | -0.0000011000001 | 0.0000009000001 | 2.0000002E-06 |
| -0.000001 | -0.0000020000 | 0.000000000001 | 2.000002E-06 |
| -0.00001 | -0.0000110000 | -0.00000899999 | 2.00002E-06 |
| -0.0001 | -0.0001010001 | -0.0000989999 | 2.0002E-06 |
| -0.001 | -0.0010010010 | -0.000998999 | 2.002E-06 |
| -0.01 | -0.0100010100 | -0.00999899 | 2.02E-06 |
| -0.1 | -0.1000011000 | -0.0999989 | 2.2E-06 |
| -1.0 | -1.0000020000 | -0.999998 | 4E-06 |
| -10.0 | -10.0000110000 | -9.999989 | 2.2E-05 |
| -100.0 | -100.0001010000 | -99.999899 | 0.000202 |
| -1000.0 | -1000.0010010000 | -999.998999 | 0.002002 |
| -10000.0 | -10000.0100010000 | -9999.989999 | 0.020002 |
| -100000.0 | -100000.1000010000 | -99999.899999 | 0.200002 |
| -1000000.0 | -1000001.0000010000 | -999998.999999 | 2.000002 |

\* If the least significant digits are beyond the precision of a IEEE74 double (approximately 17 digits), it might result in a false positive. For example, -1000001.00000100001 would still pass as being equal to -1000000.0, even though being below the lower bound.

これは丸め誤差に特化したものであり、ユーザーが明確な範囲を指定する必要がある構造関連の公差には適用されないからである。

## レンジ

**許容範囲はレンジには適用されない**したがって、範囲（minExclusive/minInclusive/maxExclusive/maxInclusive）で使用される値は、明示的に比較されるべきである。 例えば、以下のように：

|  | >1.0 | >=1.0 | <1.0 |
| ---------: | ---: | ----: | ---: |
| 0.99999999 | 失敗 | 失敗 | パス |
| 1.00000000 | 失敗 | パス | 失敗 |
| 1.00000001 | パス | パス | 失敗 |

This approach allows for specifying a custom tolerance in cases where the general rule is not applicable. For example:

- `(v - 1e-10) <= x <= (v + 1e-10)`チェック`x`等しい`v`をカスタム許容誤差1e-10で指定したもので、デフォルトの式よりはるかに正確です。
- `v <= x <= v`チェック`x`は正確に等しい`v`容赦なく

## 備考

注：これらの協定の歴史は、以下を参照されたい。[78号](https://github.com/buildingSMART/IDS/issues/78),[36号](https://github.com/buildingSMART/IDS/issues/36)そして[要約 by @giuseppeverduciALMA](https://github.com/buildingSMART/IDS/blob/0d50fd8f2dbd5b388f6fafb67da255cc3ce2b4ca/Documentation/tolerance.md).
